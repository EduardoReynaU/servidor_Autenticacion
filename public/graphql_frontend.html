<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Demo GraphQL</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    textarea { width: 100%; height: 100px; margin-top: 1rem; }
    pre { background: #f4f4f4; padding: 1rem; border-radius: 5px; }
    button { padding: 0.5rem 1rem; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <h1>Demo de Frontend con GraphQL</h1>

  <h3>1️⃣ Login con GitHub</h3>
  <label>Código de autorización (authCode):</label>
  <input type="text" id="authCode" placeholder="Pega aquí el ?code=" style="width: 300px;" />
  <button onclick="loginWithGithub()">Enviar Mutation</button>

  <h3>2️⃣ Consulta por ID (Query)</h3>
  <label>ID del usuario:</label>
  <input type="text" id="userId" placeholder="ID del usuario devuelto por login" style="width: 300px;" />
  <button onclick="queryUser()">Enviar Query</button>

  <h3>Resultado:</h3>
  <pre id="responseBox">{...esperando}</pre>

  <script>
    const endpoint = "http://localhost:3000/graphql";

    async function loginWithGithub() {
      const code = document.getElementById("authCode").value;

      const query = `
        mutation {
          loginWithGithub(authCode: "${code}") {
            id
            username
            email
            topLanguages
            avatarUrl
          }
        }
      `;

      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query })
      });

      const json = await res.json();
      document.getElementById("responseBox").textContent = JSON.stringify(json, null, 2);

      // Guardar ID para consulta
      if (json.data?.loginWithGithub?.id) {
        document.getElementById("userId").value = json.data.loginWithGithub.id;
      }
    }

    async function queryUser() {
      const id = document.getElementById("userId").value;

      const query = `
        query {
          me(id: "${id}") {
            id
            username
            email
            provider
            avatarUrl
            topLanguages
          }
        }
      `;

      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query })
      });

      const json = await res.json();
      document.getElementById("responseBox").textContent = JSON.stringify(json, null, 2);
    }
  </script>
</body>
</html>
